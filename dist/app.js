define("classes/Class",[],function(){var e=!1,t=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(n){function o(){!e&&this.init&&this.init.apply(this,arguments)}var r=this.prototype;e=!0;var i=new this;e=!1;for(var s in n)i[s]=typeof n[s]=="function"&&typeof r[s]=="function"&&t.test(n[s])?function(e,t){return function(){var n=this._super;this._super=r[e];var i=t.apply(this,arguments);return this._super=n,i}}(s,n[s]):n[s];return o.prototype=i,o.prototype.constructor=o,o.extend=arguments.callee,o}}),define("classes/SessionPoller",["jquery","underscore","classes/Class"],function(e,t,n){var r=Class.extend({_destroyCallback:{},_hasInitialized:!1,_hasSession:!1,_pollingInterval:1e4,_poller:null,_timeLeft:0,init:function(t){t&&(this._pollingInterval=t.interval||this._pollingInterval,this._destroyCallback=t.destroyCallback||e.noop())},isSessionValid:function(){return this._hasSession},keepAlive:function(){var t=app.adminSessPollURL+"/refresh";e.ajax({url:t,type:"GET",dataType:"json"}).done(function(e){}).fail(function(e, t, n){app.debug&&console.log("SessionPoller.keepAlive: refresh failed: ["+t+"] "+n)})},sessionDestroy:function(){window.clearInterval(this._poller),this._poller=null,this._hasSession=!1,this._timeLeft=0,this._destroyCallback.call(this)},sessionRestart:function(n){var r=this,i=!1;e.ajax({url:app.adminSessPollURL+"/ping",type:"GET",dataType:"json"}).done(function(e){e.logged_in&&(i=!0,r.sessionStart())}).fail(function(e, t, n){app.debug&&console.log("SessionPoller.sessionRestart: restart failed: ["+t+"] "+n)}).always(function(){t.isFunction(n)&&n.call(this,i)})},sessionStart:function(){if(this._poller)return;this._hasSession=!0,this._hasInitialized=!0;var t=this,n=function(){e.ajax({url:app.adminSessPollURL,type:"GET",dataType:"json"}).done(function(n){var r="",i="",s=e(".session-modal-close"),o=e("#session-modal-alert");s.unbind();if(n.logged_in){t._hasSession=!0,t._timeLeft=parseInt(n.time_left);var u=Math.ceil(t._timeLeft/60);if(u<5){r="Your Session is About to Expire",i="Your session will end in less than %s. To continue your session, ",i+="click the Continue button below.";var a=u+(u==1?" minute":" minutes");t._timeLeft<=30&&(a="30 seconds"),s.click(function(){o.modal("hide"),e(this).unbind(),t.keepAlive()}),t._showAlert(r,i.replace("%s",a))}}else window.clearInterval(t._poller),r="Your Session Has Ended",i="Your session has ended. You will now be redirected to the login page.",s.click(function(){o.modal("hide"),e(this).unbind(),t.sessionDestroy()}),t._showAlert(r,i)}).fail(function(e,n,r){t._hasSession=!1,app.debug&&console.log("SessionPoller.sessionStart: poll initialize failed: ["+n+"] "+r)})};this._poller=window.setInterval(n,this._pollingInterval)},_showAlert:function(t,n){e("#session-modal-label").text(t),e("#session-modal-body").text(n),e("#session-modal-alert").modal()}});return r}),define("classes/TaskParser",["jquery","classes/Class"],function(e,t){var n=Class.extend({_urlRoot:app.adminApiRoot,_dataRoot:app.adminDataRoot,_module:"login",_task:"form",_params:"",_deferredData:{},_callback:null,_deferreds:[],init:function(t){this._module=t.module||this._module,this._task=t.task||this._task,this._params=t.params||"",this._callback=t.callback&&typeof t.callback=="function"?t.callback:e.noop(),this._urlRoot+="/"+this._module,this._dataRoot+="/"+this._module},loadData:function(t){var n=this,r=function(t){return function(){return e.ajax({url:t,type:"GET",dataType:"json"}).done(function(e){n._deferredData=e,app.debug&&console.log("TaskParser: ["+n._module+"] data retrieved "+t)}).fail(function(e,t,r){app.debug&&console.log("TaskParser: ["+n._module+"] data not retrieved ["+t+"] "+r)})}()}(t);this._deferreds.push(r),e.when.apply(null,this._deferreds).done(function(){n._callback.call(n,n),n._deferreds=[]})},clearData:function(e){var t=!1;return this._deferredData[e]&&(delete this._deferredData[e],t=!0),t},getData:function(e){return this._deferredData[e]?this._deferredData[e]:!1},getModule:function(){return this._module},getParams:function(){return this._params},getTask:function(){return this._task},getUrlRoot:function(){return this._urlRoot},setParams:function(e){this._params=e}});return n}),define("classes/AbstractTaskParser",["jquery","classes/TaskParser"],function(e,t){var n=t.extend({_defaultsURI:"defaults",_deleteTask:"delete",_putTask:"add",_postTasks:["edit"],_getTasks:["list","filter"],_id:"",_page:1,init:function(e){this._super(e);if(this._params.length>0){var t=this._params.split("/");this.isPostTask()?(this._id=t[0],t.shift()):this.isGetTask()&&(this._page=parseInt(t[0]),t.shift()),this._params=t.length?"":t.join("/")}var n=this._dataRoot;this.isGetTask()?n+="/list":(n+="/form",this._id.length>0&&(n+="/"+this._id)),this.loadData(n),app.debug&&(console.log("AbstractTaskParser.getId: "+this.getId()),console.log("AbstractTaskParser.getCollectionURL: "+this.getCollectionURL()),console.log("AbstractTaskParser.getDefaultsURL: "+this.getDefaultsURL()),console.log("AbstractTaskParser.getModelURL: "+this.getModelURL()),console.log("AbstractTaskParser.getModule: "+this.getModule()),console.log("AbstractTaskParser.getTask: "+this.getTask()),console.log("AbstractTaskParser.getPage: "+this.getPage()),console.log("AbstractTaskParser.getParams: "+this.getParams()),console.log("AbstractTaskParser.isGetTask: "+this.isGetTask()),console.log("AbstractTaskParser.isPostTask: "+this.isPostTask()),console.log("AbstractTaskParser.isPutTask: "+this.isPutTask()),console.log("AbstractTaskParser.isDefaultTask: "+this.isDefaultTask()))},loadData:function(e){this._super(e)},getId:function(){return this._id},getCollectionURL:function(){if(!this.isGetTask())return this._urlRoot;var e=this._urlRoot+"/"+this._task;return this._params.length>0?e+="/"+this._page+"/"+this._params:this._page>1&&(e+="/"+this._page),e},getDefaultsURL:function(){return this._urlRoot+"/"+this._defaultsURI},getModelURL:function(){if(this.isGetTask())return this._urlRoot;var e=this._urlRoot+"/"+this._task;return this._id.length>0&&(e+="/"+this._id),this._params.length>0&&(e+="/"+this._params),e},clearData:function(e){return this._super(e)},getData:function(e){return this._super(e)},getModule:function(){return this._super()},getPage:function(){return this._page},getParams:function(){return this._super()},getTask:function(){return this._super()},getUrlRoot:function(){return this._super()},isDefaultTask:function(){return this.isDeleteTask()||this.isGetTask()||this.isPostTask()||this.isPutTask()},isDeleteTask:function(){return this._task==this._deleteTask},isGetTask:function(){return this._getTasks.indexOf(this._task)>=0},isPostTask:function(){return this._postTasks.indexOf(this._task)>=0},isPutTask:function(){return this._task==this._putTask},setParams:function(e){if(!e||!e.length)e="";else if(this.isPostTask()){var t=e.split("/");this._id=t[0],t.shift(),e=t.length?"":t.join("/")}this._params=e}});return n}),define("views/AbstractAppView",["jquery","underscore","backbone","classes/AbstractTaskParser"],function(e,t,n,r){var i=n.View.extend({id:"#tpl-app-view",$main:e("#main"),contentView:{},events:{},initialize:function(n){var r=app.TaskParser,i=t.template(n.template,{});this.setElement(e(i).first(this.id))},render:function(){return this.$el.appendTo(this.$main),this},close:function(){this._closeContentView(),this.remove()},gotoContentView:function(e){this._closeContentView();var t=e.render();if(t.promise){var n=this;t.done(function(){n._transitionPage(e)})}else this._transitionPage(e)},_closeContentView:function(){this.contentView.close?this.contentView.close():this.contentView.remove&&this.contentView.remove()},_transitionPage:function(e){var t=this;this.$el.fadeOut({duration:250,easing:"linear",complete:function(){t.contentView=e,t.$el.append(t.contentView.$el).fadeIn({duration:250,easing:"linear"}),t.contentView.loadScripts&&t.contentView.loadScripts()}})}});return i}),define("classes/LoginTaskParser",["jquery","classes/TaskParser"],function(e,t){var n=t.extend({init:function(e){this._super(e);var t=this._dataRoot+"/"+this._task;this.loadData(t),app.debug&&(console.log("LoginParser.getTask: "+this.getTask()),console.log("LoginParser.getParams: "+this.getParams()))},loadData:function(e){this._super(e)},clearData:function(e){return this._super(e)},getData:function(e){return this._super(e)},getParams:function(){return this._super()},getTask:function(){return this._super()},getUrlRoot:function(){return this._super()},setParams:function(e){this._super(e)}});return n}),define("classes/AbstractValidator",["jquery","underscore","classes/Class"],function(e,t,n){var r=Class.extend({_rules:{required:{param:null,message:"This field is required"},email:{param:null,message:"Please enter a valid email"},min:{param:0,message:"Please select at least %p item(s)"},max:{param:1,message:"Please select at most %p item(s)"},natural:{param:null,message:"Please enter a whole number"},natural_not_zero:{param:null,message:"Please enter a whole number greater than zero"},strong_password:{param:null,message:"Password must contain at least 1 uppercase, 1 lowercase and 1 number"}},_toValidate:{},init:function(e){if(t.isObject(e))for(field in e)this.addField(field,e[field])},addField:function(e,n){if(t.isEmpty(n))return!1;var r={};for(var i in n)if(app.debug&&t.isUndefined(this._rules[i])){var s="AbstractValidator.addField: Rule ["+i+"] undefined for field [";s+=e+"], validation skipped",console.log(s)}else{var o=n[i],u=t.clone(this._rules[i]),a={};t.isObject(o)?a=t.extend(u,o):(a=u,a.param=o),r[i]=a}return t.isEmpty(r)?!1:(this._toValidate[e]=r,!0)},rule:function(n,r,i){var s="",o=!0;if(!t.isString(n)||e.trim(n).length==0)o=!1,app.debug&&(s="AbstractValidator.rule: Invalid param 1 [name] must be non-zero length string",console.log(s));else if(!t.isFunction(r))o=!1,app.debug&&(s="AbstractValidator.rule: Invalid param 2 [fn] must be a function",console.log(s));else if(!t.isString(i)||e.trim(i).length==0)o=!1,app.debug&&(s="AbstractValidator.rule: Invalid param 3 [error_msg] must be non-zero length string",console.log(s));return o&&(this._rules[n]={param:null,message:i},this._validators[n]=r),o},validate:function(e){if(t.isEmpty(this._toValidate))return!0;var n={};for(var r in e){if(t.isUndefined(this._toValidate[r]))continue;var i=this._toValidate[r],s=t.isBoolean(e[r])||t.isNull(e[r])||t.isUndefined(e[r])?"":e[r],o=[];if(t.isUndefined(i.required)&&s.length==0)continue;for(var u in i){var a=i[u];if(this._validators[u].call(this,s,a.param)===!1){var f=a.message.replace("%p",a.param);o.push(f)}}o.length>0&&(n[r]=o)}return n},_validators:{email:function(e,t){var n=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i;return e.match(n)!==null},max:function(e,t){var n=parseInt(t);if(isNaN(n)&&app.debug){var r="AbstractValidator.max: Invalid parameter ["+t+"] found, validation skipped";return console.log(r),!0}return e.length<=n},min:function(e,t){var n=parseInt(t);if(isNaN(n)&&app.debug){var r="AbstractValidator.min: Invalid parameter ["+t+"] found, validation skipped";return console.log(r),!0}return e.length>=n},natural:function(e,t){return e.match(/^[0-9]+$/)!==null},natural_not_zero:function(e,t){return e!=0&&e.match(/^[0-9]+$/)!==null},required:function(n,r){return t.isString(n)&&(n=e.trim(n)),n.length>0},strong_password:function(e,t){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZ",r="abcdefghijklmnopqrstuvwxyz",i="0123456789",s=!1,o=!1,u=!1;for(var a=0;a<e.length;a++){var f=e.substr(a,1);n.search(f)>-1?s=!0:r.search(f)>-1?o=!0:i.search(f)>-1&&(u=!0)}return s&&o&&u}}});return r}),define("classes/Utils",["jquery","underscore"],function(e,t){var n={setCrsfToken:function(){var t="",n="X-CSRF-Token";if(document.cookie){var r=document.cookie.indexOf(n);if(r!=-1){var i=document.cookie.indexOf("=",r)+1,s=document.cookie.indexOf(";",r);s==-1&&(s=document.cookie.length),t=document.cookie.substring(i,s)}}e.ajaxSetup({headers:{"X-CSRF-Token":t}})}};return n}),define("models/AbstractModel",["jquery","underscore","backbone","classes/AbstractTaskParser","classes/AbstractValidator"],function(e,t,n,r,i){var s=n.Model.extend({urlRoot:"",initialize:function(e,t){t=t||{},this.urlRoot=app.TaskParser.getUrlRoot(),this.url=app.TaskParser.getModelURL()},validate:function(e,n){var r=app.TaskParser.getData("fields");if(t.isObject(r)){var i={};for(field in r)t.isUndefined(r[field].valid)||(i[field]=r[field].valid);app.Validator.init(i);var s=app.Validator.validate(e);if(!t.isEmpty(s))return s}}});return s}),define("collections/AbstractCollection",["underscore","backbone","classes/AbstractTaskParser","models/AbstractModel"],function(e,t,n,r,i){var s=t.PageableCollection.extend({columns:{},model:r,mode:"server",state:{pageSize:2,sortKey:"id",order:-1},initialize:function(e,t){t=t||{},this.url=app.TaskParser.getCollectionURL()},parseState:function(n,r,i,s){return!e.isObject(n[0])||e.isUndefined(n[0].columns)?console.log("AbstractCollection.parseState: response[0][columns] undefined."):(this.columns=n[0].columns,delete n[0].columns),t.PageableCollection.prototype.parseState.call(this,n,r,i,s)}});return s}),define("views/LoginView",["jquery","underscore","backbone","classes/LoginTaskParser","routers/AbstractRouter"],function(e,t,n,r,i){var s=n.View.extend({id:"#tpl-login-view",$main:e("#main"),events:{"click #submit-login":"login"},initialize:function(n){var r=t.template(app.LoginParser.getData("template"),{});this.setElement(e(r).first(this.id))},render:function(){return this.$main.empty(),this.$el.appendTo(this.$main),this},login:function(t){t.preventDefault();var n=this,r={user:e('#form-signin input[name="user"]').val(),pass:e('#form-signin input[name="pass"]').val()};e('#form-signin input[name="pass"]').val(""),e.ajax({url:app.adminApiRoot+"/login",data:r,type:"POST",dataType:"json"}).done(function(t){t.error?alert(t.error.text):t.logged_in?(app.SessionPoller.sessionStart(),e('#form-signin input[name="user"]').val(""),n.remove(),app.Router.navigate("admin/home",{trigger:!0})):alert("An unexpected error has occurred.")}).fail(function(e, t, n){app.debug&&console.log("Login failed: ["+t+"] "+n)})},close:function(){this.remove()}});return s}),define("views/PageView",["jquery","underscore","backbone"],function(e, t, n){var r=n.View.extend({tagName:"div",id:"#page-view",pageContent:null,slug:"",initialize:function(e){this.slug=e.slug},render:function(){var e={};return this.pageContent===null?e=this._loadPage():(this._setEl(),e=this),e},close:function(){this.remove()},_loadPage:function(){var t=e.Deferred(),n=app.adminPageRoot+"/"+this.slug,r=this;return e.get(n,function(e){r.pageContent=e,r._setEl(),app.debug&&console.log("Loaded page ["+r.slug+"] from URL: "+n),t.resolveWith(r)}).fail(function(){app.debug&&console.log("Page ["+r.slug+"] not found: "+n)}),t.promise()},_setEl:function(){this.$el.empty(),this.$el.append(this.pageContent)}});return r}),define("classes/ScriptLoader",["jquery","underscore","classes/Class"],function(e, t, n){var r=Class.extend({_jsScriptId:"view-script-onload",_css:[],_js:[],init:function(){},loadCss:function(e){if(!e)return!1;var t=typeof e=="string"?[e]:e;for(var n=0;n<t.length;n++){var e=t[n],r="",i=this._isExternalFile(e);if(i){var s=e.split("/"),o=s[s.length-1];r="css-"+o.toLowerCase().replace(".css","").replace(".","-")}else r="css-"+e.toLowerCase().replace(".css","").replace(".","-").replace("/","-");this._css.indexOf(r)!==-1&&this._removeElement(r),!i&&e.substr(0,1)==="/"&&(e=e.substr(1)),this._css.push(r);var u=document.createElement("link");u.id=r,u.type="text/css",u.rel="stylesheet",u.href=i?e:app.docRoot+"css/"+e,document.getElementsByTagName("head")[0].appendChild(u)}},loadJs:function(e,n,r){var i="module-scripts-onload",s=document.getElementById(this._jsScriptId);if(!e&&!n&&!r)return!1;s&&s.parentNode.removeChild(s),t.isString(e)&&(e=[e]);var o="\nrequire([\n",u=n||"$.noop();";u="\n"+u+"\n\n";if(r.length>0)u+="$(window).bind('page:unload', function(e){\n",u+=r+"\n",u+="$(this).unbind();\n",u+="});\n\n";else if(app.debug){var a="Warning, ScriptLoader.loadJs: param[unload_script] events ";a+="need to be unbound if they exist in param[onload_script]",console.log(a)}for(var f=0;f<e.length;f++){var l=this._isExternalFile(e[f]),c=e[f];if(!l){c.substr(0,1)==="/"&&(c=c.substr(1));var c=app.docRoot+"js/plugins/"+c}this._js.push(c),o+="	'"+c+"'"+(f<e.length-1?",":"")+"\n"}o+="], function() {\n",o+=u,o+="});\n";var h=document.createElement("script");h.id=this._jsScriptId,h.type="text/javascript";try{h.appendChild(document.createTextNode(o)),document.getElementsByTagName("body")[0].appendChild(h)}catch(p){app.debug&&console.log("Utils.loadJS: param [onload] code has errors:\n\n"+p+"\n\n"+o)}},unload:function(){e(window).trigger("page:unload");for(var t=0;t<this._css.length;t++)this._removeElement(this._css[t]);for(t=0;t<this._js.length;t++){var n=this._js[t],r=document.getElementsByTagName("script");require.undef(n);for(var i=r.length-1;i>=0;i--){var s=r[i];if(s.getAttribute("data-requiremodule")===n){s.parentNode.removeChild(s);break}}}this._removeElement(this._jsScriptId),this._css=[],this._js=[]},_isExternalFile:function(e){return typeof e=="string"&&(e.substr(0,7)=="http://"||e.substr(0,8)=="https://"||e.substr(0,2)=="//")},_removeElement:function(e){var t=document.getElementById(e);t&&t.parentNode.removeChild(t)}});return r}),define("views/AbstractFormView",["jquery","underscore","backbone","classes/AbstractTaskParser","classes/ScriptLoader","models/AbstractModel","routers/AbstractRouter"],function(e,t,n,r,i,s,o){var u=n.View.extend({id:"#tpl-form-view",form_id:"form",fields:[],scriptLoader:{},events:{"click #submit-save":"formSubmit"},initialize:function(e){var n=app.TaskParser.getData("template"),r=app.TaskParser.getData("fields");t.isEmpty(r)&&app.debug&&console.log("AbstractFormView.initialize: form [fields] not return in API call."),n.length==0&&app.debug&&console.log("AbstractFormView.initialize: form [template] not return in API call."),this.fields=r,this.template=t.template(n),this.scriptLoader=new i},render:function(){var t=app.TaskParser.getData("model");if(t){app.TaskParser.clearData("model"),this.model.set(t);var n=this.template(this.model.toJSON());return this.setElement(e(n).first(this.id)),this}var r=e.Deferred(),i=this;return this.model.fetch({success:function(t,n,s){var o=i.template(t.toJSON());i.setElement(e(o).first(i.id)),r.resolveWith(i.model)},error:function(e,t,n){app.debug&&console.log("AbstractFormView.render: model could not be initialized ["+t+"] "+n)}}),r.promise()},loadScripts:function(){var e=app.TaskParser.getData("scripts");t.isUndefined(e.css)||this.scriptLoader.loadCss(e.css);if(!t.isUndefined(e.js)){var n=e.js,r=n.src||[],i=n.onload||"",s=n.unload||"";this.scriptLoader.loadJs(r,i,s)}},close:function(){this.scriptLoader.unload(),this.remove()},formSubmit:function(){var n={},r=app.TaskParser.getData("form_id");r=r?"#"+r:this.form_id,this._removeAllErrors();for(field in this.fields){var i=t.isUndefined(this.fields[field].type)?"text":this.fields[field].type,s=t.isUndefined(this.fields[field].is_multiple)?!1:this.fields[field].is_multiple,o=this._getSelector(r,field,i,s),u="";i==="checkbox"||i==="radio"?o+=":checked":i==="select"?o+=" option:selected":i==="file";if(s){var a=[];e(o).each(function(){a.push(e(this).val())}),u=a}else{u=e(o).val();if(t.isNull(u)||t.isUndefined(u))u=!1}n[field]=u}this.model.set(n);if(!this.model.isValid()){var f=this.model.validationError;for(field in f){var i=t.isUndefined(this.fields[field].type)?"text":this.fields[field].type,s=t.isUndefined(this.fields[field].is_multiple)?!1:this.fields[field].is_multiple,o=this._getSelector(r,field,i,s);this._showErrors(o,i,f[field])}return!1}this.model.save(null,{success:function(e){alert("Model saved!")},error:function(){alert("Uh oh, ERROR!")}})},_getSelector:function(e,t,n,r){var i="input";n==="select"?i="select":n==="textarea"?i="textarea":n==="checkbox"?i="input:checkbox":n==="radio"?i="input:radio":n==="file"&&(i="input");var s=r?"[]":"";return e+" "+i+'[name="'+t+s+'"]'},_removeAllErrors:function(){e(".form-group").removeClass("has-error has-feedback"),e(".form-control-feedback").remove(),e(".field-error-message").remove()},_showErrors:function(t,n,r){var i=e(t),s=i.parents(".form-group"),o=i.parents(".field-block")||s;(n==="text"||n==="textarea"||n==="file")&&e("<span />").addClass("glyphicon glyphicon-remove form-control-feedback").insertAfter(i),e("<span />").addClass("help-block field-error-message").html(r.join("<br/>")).appendTo(o),s.addClass("has-error has-feedback")}});return u}),define("views/AbstractListView",["jquery","underscore","backbone","backgrid","classes/AbstractTaskParser","classes/ScriptLoader","collections/AbstractCollection","lib/ext/backbone.paginator","lib/ext/backgrid.paginator","lib/ext/backgrid.textcell"],function(e,t,n,r,i,s,o,u,a,f){var l=n.View.extend({id:"#tpl-list-view",scriptLoader:{},events:{},initialize:function(){var n=t.template(app.TaskParser.getData("template"),{});this.setElement(e(n).first(self.id)),this.scriptLoader=new s},render:function(){var t=new Backgrid.Extension.Paginator({renderIndexedPageHandles:!0,collection:this.collection}),n=e.Deferred();return self=this,this.collection.fetch({reset:!0,success:function(){var r=new Backgrid.Grid({columns:self.collection.columns,collection:self.collection});e("<div/>",{id:"grid"}).append(r.render().$el).appendTo(self.$el),e("<div/>",{id:"paginator"}).append(t.render().$el).appendTo(self.$el),n.resolveWith(self.collection)},error:function(e,t,n){app.debug&&console.log("AbstractListView.render: collection could not be initialized ["+t+"] "+n)}}),n.promise()},loadScripts:function(){var e=["backgrid.css","ext/backgrid.paginator.css","ext/backgrid.textcell.css"];this.scriptLoader.loadCss(e)},close:function(){this.scriptLoader.unload(),this.$el.empty(),this.remove()}});return l}),define("routers/AbstractRouter",["jquery","underscore","backbone","classes/AbstractTaskParser","classes/LoginTaskParser","classes/AbstractValidator","classes/Utils","models/AbstractModel","collections/AbstractCollection","views/LoginView","views/PageView","views/AbstractFormView","views/AbstractListView","views/AbstractAppView"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){var d=n.Router.extend({routes:{"":"home","admin/home":"home","admin/logout":"logout","admin/403":"error403","admin/404":"error404","admin/login(/:task)(/*params)":"login","admin/docs/:slug":"pageRoute","admin/:module(/:task)(/*params)":"moduleRoute","*slug":"error404"},initialize:function(e){},moduleRoute:function(e,n,i){if(!this.validateSession())return!1;o.setCrsfToken(),app.AppView.render(),t.isUndefined(app.appCache[e])||t.isUndefined(app.appCache[e][n])?app.TaskParser=new r({module:e,task:n,params:i,callback:function(t){app.TaskParser=t,t.isGetTask()?(app.Collection=new a,app.Model=new u({},{collection:app.Collection}),app.View=new h({collection:app.Collection})):(app.Validator=new s({}),app.Model=new u,app.View=new c({model:app.Model})),app.appCache[e]=app.appCache[e]||{},app.appCache[e][n]={},app.appCache[e][n].parser=app.TaskParser,app.appCache[e][n].model=app.Model,app.appCache[e][n].collection=app.Collection,app.appCache[e][n].validator=app.Validator,app.appCache[e][n].view=app.View,app.AppView.gotoContentView(app.View)}}):(app.TaskParser=app.appCache[e][n].parser,app.Model=app.appCache[e].model,app.Collection=app.appCache[e][n].collection,app.Validator=app.appCache[e][n].validator,app.View=app.appCache[e][n].view,app.TaskParser.setParams(i),app.AppView.gotoContentView(app.View))},home:function(){if(!this.validateSession())return!1;this.navigate("admin/pages/list",!0)},login:function(e,n){var r="login";e=t.isEmpty(e)?"form":e,t.isUndefined(app.appCache[r])||t.isUndefined(app.appCache[r][e])?app.LoginParser=new i({module:r,task:e,params:n,callback:function(t){app.LoginParser=t,app.View=new f,app.View.render(),app.appCache[r]=app.appCache[r]||{},app.appCache[r][e]={},app.appCache[r][e].parser=app.LoginParser,app.appCache[r][e].view=app.View}}):(app.LoginParser=app.appCache[r][e].parser,app.View=app.appCache[r][e].view,app.LoginParser.setParams(n),app.View.render())},logout:function(){e.ajax({url:app.adminApiRoot+"/logout",type:"GET",dataType:"json"}).done(function(e){e.logged_out&&app.SessionPoller.sessionDestroy()}).fail(function(e, t, n){app.debug&&console.log("Logout failed: ["+t+"] "+n)})},pageRoute:function(e){if(!this.validateSession())return!1;o.setCrsfToken(),app.AppView.render();var n="page";t.isUndefined(app.appCache[n])||t.isUndefined(app.appCache[n][e])?(app.View=new l({slug:e}),app.appCache[n]=app.appCache[n]||{},app.appCache[n][e]={},app.appCache[n][e].view=app.View):app.View=app.appCache[n][e].view,app.AppView.gotoContentView(app.View)},error403:function(){this.navigate("admin/403",!1),alert("Sorry, you are not allowed on this page.")},error404:function(){this.navigate("admin/404",!1),alert("Sorry, page not found.")},validateSession:function(){return app.SessionPoller.isSessionValid()?!0:(app.AppView.close(),app.TaskParser={},app.Model={},app.Collection={},app.View={},app.appCache={},app.Router.navigate("admin/login",{trigger:!0}),!1)}});return d});